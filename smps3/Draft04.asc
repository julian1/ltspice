Version 4
SHEET 1 5720 1740
WIRE 976 -160 400 -160
WIRE 1664 -144 1600 -144
WIRE 1920 -144 1664 -144
WIRE 2080 -144 2000 -144
WIRE 400 -96 400 -160
WIRE 976 -96 976 -160
WIRE 1600 -80 1424 -80
WIRE 1696 -80 1664 -80
WIRE 496 -16 400 -16
WIRE 1072 -16 976 -16
WIRE 1664 -16 1600 -16
WIRE 2000 -16 2000 -80
WIRE 2080 -16 2080 -64
WIRE 2080 -16 2000 -16
WIRE 1504 0 1424 0
WIRE 352 64 288 64
WIRE 928 64 864 64
WIRE 2080 64 2000 64
WIRE 1696 80 1696 -80
WIRE 1696 80 1424 80
WIRE 2000 80 2000 64
WIRE 400 112 400 80
WIRE 400 112 320 112
WIRE 976 112 976 80
WIRE 976 112 400 112
WIRE 1664 144 1664 -16
WIRE 1920 144 1664 144
WIRE 2080 144 2000 144
WIRE 400 192 400 112
WIRE 400 192 320 192
WIRE -336 464 -384 464
WIRE -208 480 -272 480
WIRE -80 480 -208 480
WIRE 688 480 400 480
WIRE -336 496 -528 496
WIRE 128 496 32 496
WIRE -80 544 -80 512
WIRE 64 544 -80 544
WIRE 32 560 32 496
WIRE 32 560 -80 560
WIRE 1264 560 1264 544
WIRE 1408 560 1264 560
WIRE 1552 560 1408 560
WIRE 1664 560 1632 560
WIRE 1264 576 1264 560
WIRE -80 592 -80 560
WIRE -384 608 -384 464
WIRE 64 608 64 544
WIRE 64 608 32 608
WIRE 96 608 64 608
WIRE 400 624 400 480
WIRE 432 624 400 624
WIRE 640 624 624 624
WIRE 688 624 688 480
WIRE 800 624 688 624
WIRE 960 640 912 640
WIRE 800 656 784 656
WIRE 1216 656 1216 464
WIRE 1216 656 1072 656
WIRE -528 672 -528 496
WIRE -384 672 -384 608
WIRE 688 688 688 624
WIRE 688 688 624 688
WIRE 784 720 784 656
WIRE 1264 896 1264 880
WIRE 1408 896 1264 896
WIRE 1552 896 1408 896
WIRE 1680 896 1632 896
WIRE 1264 912 1264 896
WIRE 784 992 784 720
WIRE 800 992 784 992
WIRE 1216 992 1216 800
WIRE 1216 992 1072 992
WIRE -32 1008 -80 1008
WIRE 64 1008 48 1008
WIRE 960 1008 912 1008
WIRE 640 1024 640 624
WIRE 800 1024 640 1024
WIRE -448 1120 -512 1120
WIRE -80 1120 -80 1008
WIRE -320 1136 -384 1136
WIRE -160 1136 -320 1136
WIRE 64 1136 64 1008
WIRE 64 1136 32 1136
WIRE 80 1136 64 1136
WIRE -624 1152 -704 1152
WIRE -608 1152 -624 1152
WIRE -448 1152 -608 1152
WIRE -80 1184 -80 1152
WIRE 64 1184 -80 1184
WIRE 32 1200 32 1136
WIRE 32 1200 -80 1200
WIRE -512 1216 -512 1120
WIRE -80 1232 -80 1200
WIRE 64 1248 64 1184
WIRE 64 1248 32 1248
WIRE -160 1264 -160 1136
WIRE -80 1264 -160 1264
WIRE -608 1280 -608 1152
FLAG -704 256 0
FLAG -704 176 VCC
FLAG 400 272 0
FLAG -880 272 0
FLAG -880 192 P15V
FLAG 400 -240 P15V
FLAG -608 1376 0
FLAG -704 1216 0
FLAG -384 1152 0
FLAG -416 1104 VCC
FLAG -320 1056 VCC
FLAG -512 1296 0
FLAG -784 1152 VCC
FLAG -624 1152 CRAMP
FLAG 320 192 IRAMP
FLAG -608 496 IRAMP
FLAG 128 496 SW
FLAG -272 496 0
FLAG -304 448 VCC
FLAG -384 752 0
FLAG -208 400 VCC
FLAG 96 608 CSW
FLAG -528 768 0
FLAG -672 720 CSW
FLAG -384 608 ISET
FLAG 528 544 VCC
FLAG 528 768 VCC
FLAG 2080 -16 0
FLAG 1504 0 0
FLAG 2080 64 0
FLAG 288 64 SW1
FLAG 864 64 SW2
FLAG 80 1136 QRST
FLAG -160 1136 RST
FLAG -144 1008 0
FLAG -304 512 0
FLAG -416 1168 0
FLAG -80 624 QRST
FLAG 432 656 QRST
FLAG 1680 896 SW2
FLAG -752 1328 QRST
FLAG 1664 560 SW1
FLAG 1264 448 VCC
FLAG 1264 672 0
FLAG 1264 784 VCC
FLAG 1264 1008 0
FLAG 1408 560 SW1-FB
FLAG 1408 896 SW2-FB
FLAG 960 672 SW2-FB
FLAG 960 976 SW1-FB
FLAG 784 720 CSW
SYMBOL voltage -704 160 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 48 40 Left 2
SYMATTR Value 5
SYMATTR InstName V2
SYMBOL ind2 384 -112 R0
SYMATTR InstName L1
SYMATTR Value 80µ
SYMATTR Type ind
SYMBOL res 384 176 R0
SYMATTR InstName R1
SYMATTR Value 0.1R
SYMBOL ind2 1408 16 M180
WINDOW 0 36 80 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName L3
SYMATTR Value 5000µ
SYMATTR Type ind
SYMBOL voltage -880 176 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 48 40 Left 2
SYMATTR Value 15
SYMATTR InstName V4
SYMBOL res 416 -144 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R7
SYMATTR Value 0.01R
SYMBOL res -688 1136 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 10k
SYMBOL cap -720 1152 R0
SYMATTR InstName C4
SYMATTR Value 1.5n
SYMBOL npn -672 1280 R0
SYMATTR InstName Q4
SYMBOL res -656 1312 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 100R
SYMBOL res -336 1040 R0
SYMATTR InstName R12
SYMATTR Value 3.3k
SYMBOL voltage -512 1200 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 48 40 Left 2
SYMATTR Value 1V
SYMATTR InstName V6
SYMBOL res -624 512 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 85 57 VBottom 2
SYMATTR InstName R10
SYMATTR Value 1k
SYMBOL res -224 384 R0
SYMATTR InstName R14
SYMATTR Value 3.3k
SYMBOL voltage -384 656 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 48 40 Left 2
SYMATTR Value 0.5V
SYMATTR InstName V5
SYMBOL res 64 992 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 10k
SYMBOL npn -592 672 R0
SYMATTR InstName Q3
SYMBOL res -576 704 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 1k
SYMBOL 74hc74 528 544 R0
SYMATTR InstName U2
SYMBOL ind2 992 0 R180
WINDOW 0 36 80 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName L2
SYMATTR Value 80µ
SYMATTR Type ind
SYMBOL diode 1616 -80 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D5
SYMBOL diode 1680 -80 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D6
SYMBOL diode 1616 -16 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D7
SYMBOL diode 1680 -16 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D8
SYMBOL cap 1984 -144 R0
SYMATTR InstName C2
SYMATTR Value 0.2µ
SYMBOL res 2064 -160 R0
SYMATTR InstName R5
SYMATTR Value 1k
SYMBOL ind2 1904 -128 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L5
SYMATTR Value 47µ
SYMATTR Type ind
SYMBOL xcomp_x11 -416 1072 R0
SYMATTR InstName U11
SYMATTR Value LM311
SYMBOL xcomp_x11 -304 416 R0
SYMATTR InstName U5
SYMATTR Value LM311
SYMBOL ind2 1408 96 M180
WINDOW 0 36 80 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName L4
SYMATTR Value 5000µ
SYMATTR Type ind
SYMBOL ind2 1904 160 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L6
SYMATTR Value 47µ
SYMATTR Type ind
SYMBOL cap 1984 80 R0
SYMATTR InstName C1
SYMATTR Value 0.2µ
SYMBOL res 2064 48 R0
SYMATTR InstName R3
SYMATTR Value 1k
SYMBOL 74hc02 -32 432 R0
SYMATTR InstName U9
SYMBOL 74hc02 -32 544 R0
SYMATTR InstName U1
SYMBOL 74hc02 -32 1072 R0
SYMATTR InstName U4
SYMBOL 74hc02 -32 1184 R0
SYMATTR InstName U10
SYMBOL cap -80 992 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value 20p
SYMBOL res 1536 576 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R19
SYMATTR Value 100R
SYMBOL res 1536 912 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R6
SYMATTR Value 100R
SYMBOL pmos 1216 544 M180
SYMATTR InstName M3
SYMATTR Value DMP31D7L
SYMATTR Prefix X
SYMBOL nmos 1216 576 R0
SYMATTR InstName M4
SYMATTR Value DMN63D8L
SYMATTR Prefix X
SYMBOL pmos 1216 880 M180
SYMATTR InstName M1
SYMATTR Value DMP31D7L
SYMATTR Prefix X
SYMBOL nmos 1216 912 R0
SYMATTR InstName M2
SYMATTR Value DMN63D8L
SYMATTR Prefix X
SYMBOL 74hc32 1008 592 R0
SYMATTR InstName U16
SYMBOL 74hc32 848 576 R0
SYMATTR InstName U3
SYMBOL 74hc32 1008 928 R0
SYMATTR InstName U6
SYMBOL 74hc32 848 944 R0
SYMATTR InstName U7
SYMBOL nmos 352 -16 R0
SYMATTR InstName M5
SYMATTR Value DMN63D8L
SYMATTR Prefix X
SYMBOL nmos 928 -16 R0
SYMATTR InstName M6
SYMATTR Value DMN63D8L
SYMATTR Prefix X
TEXT -168 -224 Left 2 !.tran 0.5ms
TEXT -208 -312 Left 2 !.include 74hc.lib
TEXT 1024 -456 Left 2 !K L1 L2 L3 L4 0.99.5
TEXT -184 -368 Left 2 !.include standard.bjt
TEXT -176 -272 Left 2 !.include LM311.301
TEXT -432 112 Left 2 ;two resistors. one emitter degen for negative feedback, \nto compensate asymetry.\nand the other for current-sense.
TEXT -1008 8 Left 2 ;no slope comp, because core should reset in push pull
TEXT -904 -224 Left 2 !.ic V(IRAMP)=0
TEXT -904 -160 Left 2 !.ic V(SW)=5 V(CSW)=0
TEXT -112 632 Left 2 ;S
TEXT -112 456 Left 2 ;R
TEXT 32 456 Left 2 ;Q
TEXT 24 632 Left 2 ;~Q
TEXT -112 1272 Left 2 ;S
TEXT -112 1096 Left 2 ;R
TEXT 32 1096 Left 2 ;Q
TEXT 24 1272 Left 2 ;~Q
TEXT -512 -224 Left 2 !.ic V(QRST)=0
TEXT -504 -176 Left 2 !.ic V(RST)=5
TEXT -1016 384 Left 2 ;1k. 10k is too high impedance for comparator.\n100R. is too heavy for bjt to pull low.
TEXT -904 -344 Left 2 !.ic V(A0)=0 V(A1)=5
TEXT -904 -312 Left 2 !.ic V(B0)=5 V(B1)=0
TEXT -200 -440 Left 2 !.include my.lib
TEXT -904 -80 Left 2 !.ic V(SW1-FB)=5 V(SW2-FB)=0
TEXT 1344 -544 Left 2 ;cmos driver. works.\nusing fets works. nice.
TEXT 1456 1144 Left 2 ;we don't even need the extra feedback. albeit kind of useful\nto enforce we have discharged the gate.\n-\nit would be better if we just ensured both switches were off during blank time\nwhich we can do with AND gate.
TEXT 576 392 Left 2 ;remember we use current-sense, to prevent drifting into saturation.\nso most cycles will be cut short. except at startup etc.
TEXT 1592 480 Left 2 ;could use fet drivers. also. with divider for feedback.
TEXT 856 528 Left 2 ;OR + inverting CMOS == NOR
