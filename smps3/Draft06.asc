Version 4
SHEET 1 5720 1740
WIRE 880 -240 816 -240
WIRE 1216 -240 880 -240
WIRE 1296 -240 1216 -240
WIRE 432 -176 80 -176
WIRE 816 -176 640 -176
WIRE 912 -176 880 -176
WIRE 80 -112 80 -176
WIRE 432 -112 432 -176
WIRE 880 -112 816 -112
WIRE 1216 -112 1216 -176
WIRE 1296 -112 1296 -160
WIRE 1296 -112 1216 -112
WIRE 720 -96 640 -96
WIRE 176 -32 80 -32
WIRE 528 -32 432 -32
WIRE 1296 -32 1216 -32
WIRE 912 -16 912 -176
WIRE 912 -16 640 -16
WIRE 1216 -16 1216 -32
WIRE 32 48 -32 48
WIRE 384 48 320 48
WIRE 880 48 880 -112
WIRE 1216 48 880 48
WIRE 1296 48 1216 48
WIRE 80 96 80 64
WIRE 80 96 0 96
WIRE 432 96 432 64
WIRE 432 96 80 96
WIRE 80 176 80 96
WIRE 80 176 0 176
WIRE 688 480 400 480
WIRE 144 528 96 528
WIRE 240 528 224 528
WIRE 1264 560 1264 544
WIRE 1408 560 1264 560
WIRE 1552 560 1408 560
WIRE 1664 560 1632 560
WIRE 1264 576 1264 560
WIRE 400 624 400 480
WIRE 432 624 400 624
WIRE 640 624 624 624
WIRE 688 624 688 480
WIRE 800 624 688 624
WIRE -272 640 -336 640
WIRE 96 640 96 528
WIRE 960 640 912 640
WIRE -144 656 -208 656
WIRE 16 656 -144 656
WIRE 240 656 240 528
WIRE 240 656 208 656
WIRE 336 656 240 656
WIRE 432 656 336 656
WIRE 800 656 784 656
WIRE 1216 656 1216 464
WIRE 1216 656 1072 656
WIRE -448 672 -528 672
WIRE -432 672 -448 672
WIRE -272 672 -432 672
WIRE 688 688 688 624
WIRE 688 688 624 688
WIRE 96 704 96 672
WIRE 240 704 96 704
WIRE 208 720 208 656
WIRE 208 720 96 720
WIRE 784 720 784 656
WIRE -336 736 -336 640
WIRE 96 752 96 720
WIRE 240 768 240 704
WIRE 240 768 208 768
WIRE 16 784 16 656
WIRE 96 784 16 784
WIRE -432 800 -432 672
WIRE 1264 896 1264 880
WIRE 1408 896 1264 896
WIRE 1552 896 1408 896
WIRE 1680 896 1632 896
WIRE 1264 912 1264 896
WIRE 784 992 784 720
WIRE 800 992 784 992
WIRE 1216 992 1216 800
WIRE 1216 992 1072 992
WIRE 960 1008 912 1008
WIRE 640 1024 640 624
WIRE 800 1024 640 1024
WIRE 784 1200 784 992
FLAG -704 256 0
FLAG -704 176 VCC
FLAG 80 256 0
FLAG -880 272 0
FLAG -880 192 P15V
FLAG 80 -256 P15V
FLAG -432 896 0
FLAG -528 736 0
FLAG -208 672 0
FLAG -240 624 VCC
FLAG -144 576 VCC
FLAG -336 816 0
FLAG -608 672 VCC
FLAG -448 672 CRAMP
FLAG 0 176 IRAMP
FLAG 528 544 VCC
FLAG 528 768 VCC
FLAG 1296 -112 0
FLAG 720 -96 0
FLAG 1296 -32 0
FLAG -32 48 SW1
FLAG 320 48 SW2
FLAG 16 656 RST
FLAG 32 528 0
FLAG -240 688 0
FLAG 336 656 QRST
FLAG 1680 896 SW2
FLAG -576 848 QRST
FLAG 1664 560 SW1
FLAG 1264 448 VCC
FLAG 1264 672 0
FLAG 1264 784 VCC
FLAG 1264 1008 0
FLAG 1408 560 SW1-FB
FLAG 1408 896 SW2-FB
FLAG 960 672 SW2-FB
FLAG 960 976 SW1-FB
FLAG 784 720 CSW
FLAG 784 1200 0
SYMBOL voltage -704 160 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 48 40 Left 2
SYMATTR Value 5
SYMATTR InstName V2
SYMBOL ind2 64 -128 R0
SYMATTR InstName L1
SYMATTR Value 5m
SYMATTR Type ind
SYMBOL res 64 160 R0
SYMATTR InstName R1
SYMATTR Value 1R
SYMBOL ind2 624 -80 M180
WINDOW 0 36 80 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName L3
SYMATTR Value 5m
SYMATTR Type ind
SYMBOL voltage -880 176 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 48 40 Left 2
SYMATTR Value 15
SYMATTR InstName V4
SYMBOL res 96 -160 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R7
SYMATTR Value 0.01R
SYMBOL res -512 656 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 10k
SYMBOL cap -544 672 R0
SYMATTR InstName C4
SYMATTR Value 20n
SYMBOL npn -496 800 R0
SYMATTR InstName Q4
SYMBOL res -480 832 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 100R
SYMBOL res -160 560 R0
SYMATTR InstName R12
SYMATTR Value 3.3k
SYMBOL voltage -336 720 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 48 40 Left 2
SYMATTR Value 1V
SYMATTR InstName V6
SYMBOL res 240 512 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 10k
SYMBOL 74hc74 528 544 R0
SYMATTR InstName U2
SYMBOL ind2 448 -16 R180
WINDOW 0 36 80 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName L2
SYMATTR Value 5m
SYMATTR Type ind
SYMBOL diode 832 -176 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D5
SYMBOL diode 896 -176 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D6
SYMBOL diode 832 -112 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D7
SYMBOL diode 896 -112 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D8
SYMBOL cap 1200 -240 R0
SYMATTR InstName C2
SYMATTR Value 1µ
SYMBOL res 1280 -256 R0
SYMATTR InstName R5
SYMATTR Value 5k
SYMBOL xcomp_x11 -240 592 R0
SYMATTR InstName U11
SYMATTR Value LM311
SYMBOL ind2 624 0 M180
WINDOW 0 36 80 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName L4
SYMATTR Value 5m
SYMATTR Type ind
SYMBOL cap 1200 -16 R0
SYMATTR InstName C1
SYMATTR Value 1µ
SYMBOL res 1280 -48 R0
SYMATTR InstName R3
SYMATTR Value 5k
SYMBOL 74hc02 144 592 R0
SYMATTR InstName U4
SYMBOL 74hc02 144 704 R0
SYMATTR InstName U10
SYMBOL cap 96 512 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value 20p
SYMBOL res 1536 576 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R19
SYMATTR Value 100R
SYMBOL res 1536 912 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R6
SYMATTR Value 100R
SYMBOL pmos 1216 544 M180
SYMATTR InstName M3
SYMATTR Value DMP31D7L
SYMATTR Prefix X
SYMBOL nmos 1216 576 R0
SYMATTR InstName M4
SYMATTR Value DMN63D8L
SYMATTR Prefix X
SYMBOL pmos 1216 880 M180
SYMATTR InstName M1
SYMATTR Value DMP31D7L
SYMATTR Prefix X
SYMBOL nmos 1216 912 R0
SYMATTR InstName M2
SYMATTR Value DMN63D8L
SYMATTR Prefix X
SYMBOL 74hc32 1008 592 R0
SYMATTR InstName U16
SYMBOL 74hc32 848 576 R0
SYMATTR InstName U3
SYMBOL 74hc32 1008 928 R0
SYMATTR InstName U6
SYMBOL 74hc32 848 944 R0
SYMATTR InstName U7
SYMBOL nmos 32 -32 R0
SYMATTR InstName M5
SYMATTR Value DMN63D8L
SYMATTR Prefix X
SYMBOL nmos 384 -32 R0
SYMATTR InstName M6
SYMATTR Value DMN63D8L
SYMATTR Prefix X
TEXT -864 -464 Left 2 !.tran 10ms
TEXT -904 -552 Left 2 !.include 74hc.lib
TEXT 704 -472 Left 2 !K L1 L2 L3 L4 0.99.5
TEXT -880 -608 Left 2 !.include standard.bjt
TEXT -872 -512 Left 2 !.include LM311.301
TEXT -1008 8 Left 2 ;no slope comp, because core should reset in push pull
TEXT 64 792 Left 2 ;S
TEXT 64 616 Left 2 ;R
TEXT 208 616 Left 2 ;Q
TEXT 200 792 Left 2 ;~Q
TEXT -904 -184 Left 2 !.ic V(QRST)=0
TEXT -896 -136 Left 2 !.ic V(RST)=5
TEXT -896 -680 Left 2 !.include my.lib
TEXT -904 -80 Left 2 !.ic V(SW1-FB)=5 V(SW2-FB)=0
TEXT 576 392 Left 2 ;remember we use current-sense, to prevent drifting into saturation.\nso most cycles will be cut short. except at startup etc.
TEXT 856 528 Left 2 ;OR + inverting CMOS == NOR
TEXT 1416 -88 Left 2 ;output caps reduced to emphasize/show ripple
TEXT 64 -640 Left 2 ;The issue is that with both switches off - we get back EMI on drains/collectors\nand cannot use sense resistor. because it would need too much current.\n- problem wiht bjt. is base current. not really wanted.\n---\nthis works quite well. only a small current on the sense resistor when unloaded
