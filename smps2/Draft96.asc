Version 4
SHEET 1 5720 1740
WIRE 976 -160 400 -160
WIRE 1664 -144 1600 -144
WIRE 1920 -144 1664 -144
WIRE 2080 -144 2000 -144
WIRE 400 -96 400 -160
WIRE 976 -96 976 -160
WIRE 1600 -80 1424 -80
WIRE 1696 -80 1664 -80
WIRE 496 -16 400 -16
WIRE 1072 -16 976 -16
WIRE 1664 -16 1600 -16
WIRE 2000 -16 2000 -80
WIRE 2080 -16 2080 -64
WIRE 2080 -16 2000 -16
WIRE 1504 0 1424 0
WIRE 336 32 320 32
WIRE 912 32 896 32
WIRE 2080 64 2000 64
WIRE 1696 80 1696 -80
WIRE 1696 80 1424 80
WIRE 2000 80 2000 64
WIRE 400 112 400 80
WIRE 400 112 320 112
WIRE 976 112 976 80
WIRE 976 112 400 112
WIRE 1664 144 1664 -16
WIRE 1920 144 1664 144
WIRE 2080 144 2000 144
WIRE 400 192 320 192
WIRE 464 384 336 384
WIRE -336 464 -384 464
WIRE -208 480 -272 480
WIRE -80 480 -208 480
WIRE 1040 480 976 480
WIRE -336 496 -528 496
WIRE 128 496 32 496
WIRE 336 496 336 384
WIRE 1168 496 1104 496
WIRE 544 512 544 384
WIRE 544 512 448 512
WIRE 592 512 544 512
WIRE 864 512 784 512
WIRE 880 512 864 512
WIRE 1040 512 880 512
WIRE -80 544 -80 512
WIRE 64 544 -80 544
WIRE 32 560 32 496
WIRE 32 560 -80 560
WIRE 336 560 336 528
WIRE 480 560 336 560
WIRE 448 576 448 512
WIRE 448 576 336 576
WIRE 976 576 976 480
WIRE -80 592 -80 560
WIRE -384 608 -384 464
WIRE 64 608 64 544
WIRE 64 608 32 608
WIRE 96 608 64 608
WIRE 336 608 336 576
WIRE 480 624 480 560
WIRE 480 624 448 624
WIRE 880 640 880 512
WIRE -528 672 -528 496
WIRE -384 672 -384 608
WIRE 592 688 592 512
WIRE 736 688 592 688
WIRE -80 800 -80 624
WIRE 336 800 336 640
WIRE 336 800 -80 800
WIRE 592 800 336 800
WIRE 1168 800 1168 496
WIRE 1168 800 592 800
WIRE 80 1008 48 1008
WIRE 416 1008 272 1008
WIRE 528 1024 528 1008
WIRE -80 1040 -80 800
WIRE 80 1040 -80 1040
WIRE 528 1040 528 1024
WIRE 304 1072 272 1072
WIRE 784 1088 784 1072
WIRE 784 1104 784 1088
WIRE 528 1152 528 1040
WIRE 640 1152 528 1152
WIRE 48 1392 48 1008
WIRE 304 1392 304 1072
WIRE 304 1392 48 1392
WIRE 416 1392 304 1392
WIRE 528 1408 528 1392
WIRE 528 1424 528 1408
WIRE 784 1472 784 1456
WIRE 784 1488 784 1472
WIRE 528 1536 528 1424
WIRE 640 1536 528 1536
FLAG -320 1248 0
FLAG -320 1168 VCC
FLAG 400 272 0
FLAG -496 1264 0
FLAG -496 1184 P15V
FLAG 400 -240 P15V
FLAG 880 736 0
FLAG 784 576 0
FLAG 1104 512 0
FLAG 1072 464 VCC
FLAG 1168 416 VCC
FLAG 976 656 0
FLAG 704 512 VCC
FLAG 864 512 CRAMP
FLAG 320 192 IRAMP
FLAG -608 496 IRAMP
FLAG 128 496 SW
FLAG -272 496 0
FLAG -304 448 VCC
FLAG -384 752 0
FLAG -208 400 VCC
FLAG 96 608 CSW
FLAG -528 768 0
FLAG -672 720 CSW
FLAG -384 608 ISET
FLAG 176 928 VCC
FLAG 176 1152 VCC
FLAG 416 1040 SW
FLAG 864 1088 SW1
FLAG 864 1472 SW2
FLAG 2080 -16 0
FLAG 416 1424 SW
FLAG 1504 0 0
FLAG 2080 64 0
FLAG 320 32 SW1
FLAG 896 32 SW2
FLAG 784 976 VCC
FLAG 784 1200 0
FLAG 784 1360 VCC
FLAG 784 1584 0
FLAG 592 512 QRST
FLAG 592 800 RST
FLAG 272 384 0
FLAG -304 512 0
FLAG 1072 528 0
SYMBOL voltage -320 1152 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 48 40 Left 2
SYMATTR Value 5
SYMATTR InstName V2
SYMBOL ind2 384 -112 R0
SYMATTR InstName L1
SYMATTR Value 80µ
SYMATTR Type ind
SYMBOL npn 336 -16 R0
SYMATTR InstName Q1
SYMATTR Value FJL4315
SYMBOL res 384 176 R0
SYMATTR InstName R1
SYMATTR Value 0.1R
SYMBOL ind2 1408 16 M180
WINDOW 0 36 80 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName L3
SYMATTR Value 5000µ
SYMATTR Type ind
SYMBOL voltage -496 1168 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 48 40 Left 2
SYMATTR Value 15
SYMATTR InstName V4
SYMBOL res 416 -144 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R7
SYMATTR Value 0.01R
SYMBOL res 800 496 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 10k
SYMBOL cap 768 512 R0
SYMATTR InstName C4
SYMATTR Value 1.5n
SYMBOL npn 816 640 R0
SYMATTR InstName Q4
SYMBOL res 832 672 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 100R
SYMBOL res 1152 400 R0
SYMATTR InstName R12
SYMATTR Value 3.3k
SYMBOL voltage 976 560 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 48 40 Left 2
SYMATTR Value 1V
SYMATTR InstName V6
SYMBOL res -624 512 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 85 57 VBottom 2
SYMATTR InstName R10
SYMATTR Value 1k
SYMBOL res -224 384 R0
SYMATTR InstName R14
SYMATTR Value 3.3k
SYMBOL voltage -384 656 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 48 40 Left 2
SYMATTR Value 0.6V
SYMATTR InstName V5
SYMBOL res 560 368 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 10k
SYMBOL npn -592 672 R0
SYMATTR InstName Q3
SYMBOL res -576 704 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 1k
SYMBOL 74hc74 176 928 R0
SYMATTR InstName U2
SYMBOL ind2 992 0 R180
WINDOW 0 36 80 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName L2
SYMATTR Value 80µ
SYMATTR Type ind
SYMBOL npn 912 -16 R0
SYMATTR InstName Q2
SYMATTR Value FJL4315
SYMBOL diode 1616 -80 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D5
SYMBOL diode 1680 -80 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D6
SYMBOL diode 1616 -16 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D7
SYMBOL diode 1680 -16 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D8
SYMBOL cap 1984 -144 R0
SYMATTR InstName C2
SYMATTR Value 0.2µ
SYMBOL res 2064 -160 R0
SYMATTR InstName R5
SYMATTR Value 1k
SYMBOL ind2 1904 -128 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L5
SYMATTR Value 47µ
SYMATTR Type ind
SYMBOL xcomp_x11 1072 432 R0
SYMATTR InstName U11
SYMATTR Value LM311
SYMBOL xcomp_x11 -304 416 R0
SYMATTR InstName U5
SYMATTR Value LM311
SYMBOL ind2 1408 96 M180
WINDOW 0 36 80 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName L4
SYMATTR Value 5000µ
SYMATTR Type ind
SYMBOL ind2 1904 160 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L6
SYMATTR Value 47µ
SYMATTR Type ind
SYMBOL cap 1984 80 R0
SYMATTR InstName C1
SYMATTR Value 0.2µ
SYMBOL res 2064 48 R0
SYMATTR InstName R3
SYMATTR Value 1k
SYMBOL res 736 1136 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R16
SYMATTR Value 1k
SYMBOL res 736 1392 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R21
SYMATTR Value 1k
SYMBOL npn 720 1104 R0
SYMATTR InstName Q5
SYMATTR Value 2N3904
SYMBOL npn 720 1360 R0
SYMATTR InstName Q6
SYMATTR Value 2N3904
SYMBOL 74hc00 464 960 R0
SYMATTR InstName U3
SYMBOL 74hc00 464 1344 R0
SYMATTR InstName U7
SYMBOL 74hc00 576 1344 R0
SYMATTR InstName U8
SYMBOL npn 720 976 R0
SYMATTR InstName Q7
SYMATTR Value 2N3904
SYMBOL res 736 1008 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 1k
SYMBOL 74hc00 576 960 R0
SYMATTR InstName U6
SYMBOL npn 720 1488 R0
SYMATTR InstName Q8
SYMATTR Value 2N3904
SYMBOL res 736 1520 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 1k
SYMBOL res 880 1072 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R13
SYMATTR Value 25R
SYMBOL res 880 1456 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R19
SYMATTR Value 25R
SYMBOL res 384 96 R0
SYMATTR InstName R15
SYMATTR Value 0.1R
SYMBOL 74hc02 -32 432 R0
SYMATTR InstName U9
SYMBOL 74hc02 -32 544 R0
SYMATTR InstName U1
SYMBOL 74hc02 384 448 R0
SYMATTR InstName U4
SYMBOL 74hc02 384 560 R0
SYMATTR InstName U10
SYMBOL cap 336 368 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value 20p
TEXT -168 -224 Left 2 !.tran 0.5ms
TEXT -208 -312 Left 2 !.include 74hc.lib
TEXT 1024 -456 Left 2 !K L1 L2 L3 L4 0.99.5
TEXT 1592 608 Left 2 ;current mode control,  with slope compensation to support duty cycle > 50%.\nIset controls power\n \nSlope compensation is implemented by summing the cycle periodic ramp \nwith the sensed current signal.\n \nfail case, if iset is too high (ie. exceed cramp) then do not get switch off cross\nevent. need clamp.  OR second safety current trip point comparator that can fire \nanytime in the cycle, to protect bjt/fet switch.\n \nflyback needs snubber, voltage regulation feedback loop.\nforward converter, needs reset winding, and boost topology secondary.\npush pull,  would mux the bjt to turn on,  with another flipflop/and gate\n \nIn a push pull the extra complementary magnetic winding, will work for the reset/snubber.\nOr the output windings will, with a non blocking rectifier.
TEXT 1592 232 Left 2 ;EXTR. With transformer coupling the current-ramp slope is determined by\nthe inductor on the secondary. same as a forward converter.\nlA R or C load without energy storage, results in short-sharp  current ramp.\n \nadding storage (an inductor) on the secondary, slows the ramp as seen on primary\n \nIf increase Load (eg. R=5R), then should increase cap size,\nSo that inductor is *not* loaded, and current ramp is shallower.\nthis isn't intuitive. Because larger cap size, means stepper ramp at cold-start.\nOR just add energy storage inductor on the secondary. SO that the \ntransformer current doesnt see 0Z load of just the cap.
TEXT -184 -368 Left 2 !.include standard.bjt
TEXT -176 -272 Left 2 !.include LM311.301
TEXT 1168 -336 Left 2 ;push pull using darlingtons. works.
TEXT 984 1320 Left 2 ;npn low. to avoid VBE drop, when driving a bjt.\nA small amount of cross conduction of drivers does not matter,\nbecause bjt current Ic is inherently limited.\nthis driver will also work for fets.
TEXT -432 112 Left 2 ;two resistors. one emitter degen for negative feedback, \nto compensate asymetry.\nand the other for current-sense.
TEXT -1008 8 Left 2 ;no slope comp, because core should reset in push pull
TEXT -904 -224 Left 2 !.ic V(IRAMP)=0
TEXT -904 -160 Left 2 !.ic V(SW)=0
TEXT -904 -128 Left 2 !.ic V(CSW)=5
TEXT -112 632 Left 2 ;S
TEXT -112 456 Left 2 ;R
TEXT 32 456 Left 2 ;Q
TEXT 24 632 Left 2 ;~Q
TEXT 304 648 Left 2 ;S
TEXT 304 472 Left 2 ;R
TEXT 448 472 Left 2 ;Q
TEXT 440 648 Left 2 ;~Q
TEXT -512 -224 Left 2 !.ic V(QRST)=0
TEXT -504 -176 Left 2 !.ic V(RST)=5
TEXT -1016 384 Left 2 ;1k. 10k is too high impedance for comparator.\n100R. is too heavy for bjt to pull low.
