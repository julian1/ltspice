Version 4
SHEET 1 5720 1740
WIRE 1664 -144 1600 -144
WIRE 1920 -144 1664 -144
WIRE 2080 -144 2000 -144
WIRE 400 -96 400 -160
WIRE 976 -96 976 -160
WIRE -448 -80 -528 -80
WIRE 1600 -80 1424 -80
WIRE 1696 -80 1664 -80
WIRE -528 -64 -528 -80
WIRE -448 -64 -448 -80
WIRE 496 -16 400 -16
WIRE 832 -16 816 -16
WIRE 1072 -16 976 -16
WIRE 1664 -16 1600 -16
WIRE 2000 -16 2000 -80
WIRE 2080 -16 2080 -64
WIRE 2080 -16 2000 -16
WIRE 1504 0 1424 0
WIRE 336 32 320 32
WIRE 912 32 896 32
WIRE 2080 64 2000 64
WIRE 1696 80 1696 -80
WIRE 1696 80 1424 80
WIRE 2000 80 2000 64
WIRE 400 112 400 80
WIRE 400 112 320 112
WIRE 544 112 400 112
WIRE 896 112 544 112
WIRE 976 112 976 80
WIRE 976 112 896 112
WIRE 1664 144 1664 -16
WIRE 1920 144 1664 144
WIRE 2080 144 2000 144
WIRE -112 368 -144 368
WIRE 0 368 -32 368
WIRE 208 432 160 432
WIRE -144 448 -144 368
WIRE -96 448 -144 448
WIRE 336 448 272 448
WIRE 528 448 336 448
WIRE 0 464 0 368
WIRE 0 464 -32 464
WIRE 80 464 0 464
WIRE 208 464 80 464
WIRE 640 464 624 464
WIRE 720 464 640 464
WIRE -96 480 -144 480
WIRE 160 496 160 432
WIRE 640 512 640 464
WIRE 640 512 512 512
WIRE -144 544 -144 480
WIRE 528 544 528 480
WIRE 640 544 528 544
WIRE 704 544 640 544
WIRE 160 560 160 496
WIRE 512 576 512 512
WIRE 528 576 512 576
WIRE 640 592 640 544
WIRE -144 656 -144 544
WIRE 752 752 720 752
WIRE 1088 752 944 752
WIRE 528 784 528 608
WIRE 752 784 528 784
WIRE 976 816 944 816
WIRE 112 912 48 912
WIRE 240 928 192 928
WIRE 336 928 240 928
WIRE -128 944 -208 944
WIRE -112 944 -128 944
WIRE 112 944 -112 944
WIRE 720 976 720 752
WIRE 976 976 976 816
WIRE 976 976 720 976
WIRE 1088 976 976 976
WIRE 448 992 448 944
WIRE 448 992 320 992
WIRE 48 1008 48 912
WIRE 336 1024 336 960
WIRE 448 1024 336 1024
WIRE 320 1056 320 992
WIRE 336 1056 320 1056
WIRE -112 1072 -112 944
WIRE 448 1072 448 1024
WIRE 528 1072 528 784
WIRE 528 1072 448 1072
WIRE 704 1072 608 1072
WIRE 336 1200 336 1088
WIRE 704 1200 704 1072
WIRE 704 1200 336 1200
WIRE -256 1264 -256 1120
WIRE 448 1264 448 1072
WIRE 448 1264 -256 1264
FLAG -448 -64 0
FLAG -528 -160 VCC
FLAG -528 16 VEE
FLAG 400 192 0
FLAG -704 -64 0
FLAG -704 -144 P15V
FLAG 400 -240 P15V
FLAG -144 288 0
FLAG -64 432 VCC
FLAG -64 496 VEE
FLAG 544 112 IRAMP
FLAG -224 480 IRAMP
FLAG 720 464 SW
FLAG 272 464 0
FLAG 240 416 VCC
FLAG 240 480 VEE
FLAG 160 640 0
FLAG 336 368 VCC
FLAG 704 544 CSW
FLAG 80 464 SUMRAMP
FLAG -144 752 0
FLAG -288 704 CSW
FLAG -224 544 CRAMP
FLAG 160 496 ISET
FLAG 848 672 VCC
FLAG 848 896 VCC
FLAG 1088 784 SW
FLAG 1200 768 SW1
FLAG 1200 992 SW2
FLAG 976 -240 P15V
FLAG 2080 -16 0
FLAG 1088 1008 SW
FLAG 1504 0 0
FLAG 2080 64 0
FLAG 176 -16 SW1
FLAG 736 -16 SW2
FLAG 320 -64 P15V
FLAG 896 -64 P15V
FLAG -112 1168 0
FLAG -208 1008 0
FLAG 128 976 0
FLAG 144 880 VCC
FLAG 144 976 VEE
FLAG 240 848 VCC
FLAG 48 1088 0
FLAG -288 944 VCC
FLAG -128 944 CRAMP
FLAG 608 1136 0
SYMBOL voltage -528 -176 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 48 40 Left 2
SYMATTR Value 5
SYMATTR InstName V2
SYMBOL voltage -528 -80 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 0 36 39 Left 2
SYMATTR InstName V3
SYMATTR Value 0
SYMBOL ind2 384 -112 R0
SYMATTR InstName L1
SYMATTR Value 80µ
SYMATTR Type ind
SYMBOL npn 336 -16 R0
SYMATTR InstName Q1
SYMATTR Value FJL4315
SYMBOL res 384 96 R0
SYMATTR InstName R1
SYMATTR Value 0.1R
SYMBOL ind2 1408 16 M180
WINDOW 0 36 80 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName L3
SYMATTR Value 5000µ
SYMATTR Type ind
SYMBOL voltage -704 -160 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 48 40 Left 2
SYMATTR Value 15
SYMATTR InstName V4
SYMBOL res 416 -144 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R7
SYMATTR Value 0.01R
SYMBOL OpAmps\\LT1006 -64 400 R0
WINDOW 3 30 120 Left 2
SYMATTR InstName U3
SYMBOL res -128 384 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R6
SYMATTR Value 10k
SYMBOL res -16 352 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 10k
SYMBOL res -240 496 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 85 57 VBottom 2
SYMATTR InstName R10
SYMATTR Value 10k
SYMBOL res -240 560 R270
WINDOW 0 -32 55 VTop 2
WINDOW 3 -32 56 VBottom 2
SYMATTR InstName R13
SYMATTR Value 10k
SYMBOL res 320 352 R0
SYMATTR InstName R14
SYMATTR Value 3.3k
SYMBOL voltage 160 544 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 48 40 Left 2
SYMATTR Value 0.6V
SYMATTR InstName V5
SYMBOL npn -208 656 R0
SYMATTR InstName Q3
SYMBOL res -192 688 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 5k
SYMBOL 74hc74 848 672 R0
SYMATTR InstName U2
SYMBOL 74hc08 1136 704 R0
SYMATTR InstName U7
SYMBOL ind2 992 0 R180
WINDOW 0 36 80 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName L2
SYMATTR Value 80µ
SYMATTR Type ind
SYMBOL npn 912 -16 R0
SYMATTR InstName Q2
SYMATTR Value FJL4315
SYMBOL res 992 -144 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R17
SYMATTR Value 0.01R
SYMBOL diode 1616 -80 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D5
SYMBOL diode 1680 -80 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D6
SYMBOL diode 1616 -16 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D7
SYMBOL diode 1680 -16 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D8
SYMBOL cap 1984 -144 R0
SYMATTR InstName C2
SYMATTR Value 0.2µ
SYMBOL res 2064 -160 R0
SYMATTR InstName R5
SYMATTR Value 1k
SYMBOL ind2 1904 -128 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L5
SYMATTR Value 47µ
SYMATTR Type ind
SYMBOL 74hc08 1136 928 R0
SYMATTR InstName U9
SYMBOL xcomp_x11 240 384 R0
SYMATTR InstName U5
SYMATTR Value LM311
SYMBOL ind2 1408 96 M180
WINDOW 0 36 80 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName L4
SYMATTR Value 5000µ
SYMATTR Type ind
SYMBOL ind2 1904 160 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L6
SYMATTR Value 47µ
SYMATTR Type ind
SYMBOL cap 1984 80 R0
SYMATTR InstName C1
SYMATTR Value 0.2µ
SYMBOL res 2064 48 R0
SYMATTR InstName R3
SYMATTR Value 20k
SYMBOL res 272 -32 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R16
SYMATTR Value 1k
SYMBOL res 832 -32 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R21
SYMATTR Value 1k
SYMBOL npn 256 -64 R0
SYMATTR InstName Q5
SYMATTR Value 2N3904
SYMBOL res 336 128 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R15
SYMATTR Value 120R
SYMBOL npn 832 -64 R0
SYMATTR InstName Q6
SYMATTR Value 2N3904
SYMBOL res 912 128 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R18
SYMATTR Value 120R
SYMBOL res -192 928 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R19
SYMATTR Value 2k
SYMBOL cap -224 944 R0
SYMATTR InstName C3
SYMATTR Value 12n
SYMBOL npn -176 1072 R0
SYMATTR InstName Q7
SYMBOL res -160 1104 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R20
SYMATTR Value 200R
SYMBOL Comparators\\LT1011 144 928 R0
SYMATTR InstName U6
SYMBOL res 224 832 R0
SYMATTR InstName R22
SYMATTR Value 3.3k
SYMBOL voltage 48 992 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 48 40 Left 2
SYMATTR Value 1V
SYMATTR InstName V1
SYMBOL 74hc02 384 880 R0
SYMATTR InstName U8
SYMBOL 74hc02 384 1008 R0
SYMATTR InstName U10
SYMBOL res 624 1056 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R23
SYMATTR Value 10k
SYMBOL cap 592 1072 R0
SYMATTR InstName C5
SYMATTR Value 20p
SYMBOL 74hc02 576 400 R0
SYMATTR InstName U4
SYMBOL 74hc02 576 528 R0
SYMATTR InstName U11
TEXT -168 -224 Left 2 !.tran 0.5ms
TEXT -208 -312 Left 2 !.include 74hc.lib
TEXT 1024 -456 Left 2 !K L1 L2 L3 L4 0.99.5
TEXT 1592 608 Left 2 ;current mode control,  with slope compensation to support duty cycle > 50%.\nIset controls power\n \nSlope compensation is implemented by summing the cycle periodic ramp \nwith the sensed current signal.\n \nfail case, if iset is too high (ie. exceed cramp) then do not get switch off cross\nevent. need clamp.  OR second safety current trip point comparator that can fire \nanytime in the cycle, to protect bjt/fet switch.\n \nflyback needs snubber, voltage regulation feedback loop.\nforward converter, needs reset winding, and boost topology secondary.\npush pull,  would mux the bjt to turn on,  with another flipflop/and gate\n \nIn a push pull the extra complementary magnetic winding, will work for the reset/snubber.\nOr the output windings will, with a non blocking rectifier.
TEXT 1592 232 Left 2 ;EXTR. With transformer coupling the current-ramp slope is determined by\nthe inductor on the secondary. same as a forward converter.\nlA R or C load without energy storage, results in short-sharp  current ramp.\n \nadding storage (an inductor) on the secondary, slows the ramp as seen on primary\n \nIf increase Load (eg. R=5R), then should increase cap size,\nSo that inductor is *not* loaded, and current ramp is shallower.\nthis isn't intuitive. Because larger cap size, means stepper ramp at cold-start.\nOR just add energy storage inductor on the secondary. SO that the \ntransformer current doesnt see 0Z load of just the cap.
TEXT -184 -368 Left 2 !.include standard.bjt
TEXT -176 -272 Left 2 !.include LM311.301
TEXT 1168 -336 Left 2 ;push pull using darlingtons. works.
TEXT -256 -136 Left 2 !.ic V(CRAMP)=0
TEXT 496 424 Left 2 ;R
TEXT 328 912 Left 2 ;R
TEXT 496 616 Left 2 ;S
TEXT 312 1096 Left 2 ;S
