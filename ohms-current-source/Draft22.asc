Version 4
SHEET 1 1768 980
WIRE 544 -144 448 -144
WIRE 768 -144 640 -144
WIRE -64 16 -64 -48
WIRE 112 16 -64 16
WIRE 352 16 192 16
WIRE 448 16 448 -144
WIRE 448 16 352 16
WIRE 480 16 448 16
WIRE 592 16 592 -80
WIRE 592 16 560 16
WIRE 672 16 592 16
WIRE 352 80 352 16
WIRE 384 80 352 80
WIRE 672 80 672 16
WIRE 496 96 448 96
WIRE 624 96 576 96
WIRE -64 112 -64 96
WIRE 384 112 -64 112
WIRE -64 128 -64 112
WIRE -352 176 -384 176
WIRE -240 192 -288 192
WIRE -112 192 -160 192
WIRE 672 192 672 176
WIRE 768 192 768 -144
WIRE 768 192 672 192
WIRE -352 208 -544 208
WIRE -544 224 -544 208
WIRE 672 240 672 192
WIRE -384 304 -384 176
WIRE -64 304 -64 208
WIRE -64 304 -384 304
WIRE 672 448 672 304
WIRE 752 448 672 448
WIRE 672 480 672 448
WIRE 608 528 560 528
WIRE 496 576 416 576
WIRE 752 576 672 576
WIRE 608 624 560 624
WIRE 416 672 416 656
WIRE 496 672 416 672
WIRE 112 752 0 752
WIRE 560 752 560 720
WIRE 560 752 416 752
WIRE 672 752 672 672
WIRE 672 752 560 752
WIRE 832 752 672 752
WIRE 672 880 672 752
WIRE 672 880 240 880
FLAG 112 752 0
FLAG 0 832 VEE2
FLAG 0 672 VCC2
FLAG 416 128 VEE2
FLAG 416 64 VCC2
FLAG -320 224 VEE2
FLAG -320 160 VCC2
FLAG -544 304 0
FLAG -64 384 0
FLAG -64 -48 VCC2
FLAG 784 832 0
FLAG 832 752 MEAS
FLAG 32 384 0
FLAG 240 960 0
FLAG 336 512 0
SYMBOL voltage 0 736 R0
WINDOW 0 54 29 Left 2
WINDOW 3 50 56 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 15
SYMBOL res 928 784 R0
SYMATTR InstName RDUT
SYMATTR Value 1k
SYMBOL res 208 0 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName ISET
SYMATTR Value 100k
SYMBOL pmos 624 176 M180
SYMATTR InstName M1
SYMBOL voltage 0 656 R0
WINDOW 0 54 29 Left 2
WINDOW 3 50 56 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 15
SYMBOL res 592 80 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 10k
SYMBOL res 576 0 R90
WINDOW 0 -33 56 VBottom 2
WINDOW 3 -27 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 22k
SYMBOL pnp 640 -80 M270
SYMATTR InstName Q1
SYMBOL OpAmps\\ADA4625 416 32 R0
WINDOW 3 -165 146 Left 2
SYMATTR InstName U2
SYMBOL diode 656 240 R0
SYMATTR InstName D1
SYMBOL res -80 288 R0
SYMATTR InstName R5
SYMATTR Value 40k
SYMBOL res -144 176 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 10k
SYMBOL OpAmps\\ADA4625 -320 128 R0
WINDOW 3 -23 195 Left 2
SYMATTR InstName U1
SYMBOL voltage -544 208 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 46 44 Left 2
WINDOW 0 38 16 Left 2
SYMATTR Value 7
SYMATTR InstName VREF
SYMBOL res -80 0 R0
SYMATTR InstName R7
SYMATTR Value 28.57k
SYMBOL nmos -112 112 R0
SYMATTR InstName M2
SYMBOL res 16 288 R0
SYMATTR InstName R1
SYMATTR Value 400k
SYMBOL pnp 608 576 M180
SYMATTR InstName Q2
SYMBOL pnp 608 672 M180
SYMATTR InstName Q3
SYMBOL pnp 496 624 M180
SYMATTR InstName Q4
SYMBOL pnp 496 720 M180
SYMATTR InstName Q5
SYMBOL res 400 560 R0
SYMATTR InstName R3
SYMATTR Value 300k
SYMBOL res 400 656 R0
SYMATTR InstName R8
SYMATTR Value 300k
SYMBOL voltage 240 864 R0
WINDOW 0 54 29 Left 2
WINDOW 3 50 56 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value -1100V
SYMBOL diode 400 512 R0
SYMATTR InstName D2
SYMBOL res 432 496 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 0.1R
TEXT -224 16 Left 2 !.tran 0.1
TEXT -400 456 Left 2 ;lhs, circuit creates prec drop, with headroom\nR5=40k, put 5V drop on R7, referenced to the supply rail.\nCan gain a range, (OR FOR ACAL ? )\nExtra R in parallel and mux feedback.\nie. R5=400k, put 0.5V drop.
TEXT 432 -280 Left 2 ;'over-the-top' voltage to current.\nbjt is high-current path
TEXT 56 -368 Left 2 ;34401a style ohms current source.\nIset , with R5=40k\n1k -> 5mA\n1Meg -> 5uA\nNeed kelvin taps.\netc
TEXT 288 -16 Left 2 ;sum
TEXT 872 552 Left 2 ;- Middle point of two bjts sees half the voltage.\nresistors set current on overload. can be used to turn on optocoupler.\neg. 300k.\n1100V / 600k = 1.8mA.\n- \n- more bjts means more drop. and more headrooom needed\n- diode should be bav199, mmbf4117. etc
TEXT 872 416 Left 2 ;can use optocoupler to sense overload.\nBut not very reliably. unless use a current limit.\ncurrent depends on size of voltage drop, and size of resistors
TEXT 848 160 Left 2 ;the way to reduce leakage is to use a p jfet perhaps?\nor depletion. something with less protection
TEXT 856 8 Left 2 ;The diode + bjts protect from voltage.\nBut hv sink. is too much current. eg. 10mA*-700V=7W dissipation.
