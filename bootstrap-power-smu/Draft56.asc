Version 4
SHEET 1 2756 2104
WIRE 368 -624 192 -624
WIRE 704 -624 368 -624
WIRE 880 -624 704 -624
WIRE 1024 -624 880 -624
WIRE 1120 -624 1024 -624
WIRE 368 -592 368 -624
WIRE 880 -592 880 -624
WIRE 304 -544 192 -544
WIRE 816 -544 704 -544
WIRE 368 -496 256 -496
WIRE 880 -496 768 -496
WIRE 1120 -384 1120 -624
WIRE 704 -304 704 -448
WIRE 800 -304 704 -304
WIRE 960 -304 864 -304
WIRE 1056 -304 960 -304
WIRE 1072 -304 1056 -304
WIRE -256 -288 -336 -288
WIRE -336 -272 -336 -288
WIRE 1120 -240 1120 -288
WIRE 1120 -240 1056 -240
WIRE 1056 -224 1056 -240
WIRE 1056 -224 960 -224
WIRE 1120 -176 1120 -240
WIRE 1216 -176 1184 -176
WIRE 1120 -96 1120 -176
WIRE -160 -64 -160 -80
WIRE 1440 -64 1344 -64
WIRE -160 -32 -160 -64
WIRE 704 -16 704 -304
WIRE 784 -16 704 -16
WIRE 1072 -16 784 -16
WIRE 1120 16 1120 0
WIRE 1248 16 1200 16
WIRE 784 48 704 48
WIRE 1120 48 1120 16
WIRE 1120 48 992 48
WIRE 704 96 704 48
WIRE 784 96 704 96
WIRE 896 96 784 96
WIRE 928 96 896 96
WIRE 1120 96 1120 48
WIRE 1056 144 992 144
WIRE 784 160 704 160
WIRE -544 208 -624 208
WIRE -416 208 -544 208
WIRE 400 208 -336 208
WIRE 896 224 896 96
WIRE 1120 224 1120 192
WIRE 1120 224 992 224
WIRE 1120 272 1120 224
WIRE 1120 272 1040 272
WIRE 192 304 192 -448
WIRE 192 304 96 304
WIRE 256 304 192 304
WIRE -128 352 -160 352
WIRE -16 352 -48 352
WIRE 32 352 -16 352
WIRE 400 352 400 208
WIRE 400 352 320 352
WIRE 432 352 400 352
WIRE 896 352 896 320
WIRE 896 352 496 352
WIRE 1120 352 896 352
WIRE 1280 352 1120 352
WIRE 1328 352 1280 352
WIRE 1472 352 1408 352
WIRE 1568 352 1472 352
WIRE 1616 352 1568 352
WIRE -16 400 -16 352
WIRE 1120 432 992 432
WIRE -944 464 -1056 464
WIRE 1120 464 1120 432
WIRE 1056 512 992 512
WIRE -1904 528 -1904 480
WIRE -1696 528 -1792 528
WIRE 704 560 704 160
WIRE 928 560 704 560
WIRE -1792 576 -1792 528
WIRE -1776 576 -1792 576
WIRE -1696 592 -1696 528
WIRE -1696 592 -1712 592
WIRE -1584 592 -1696 592
WIRE -1488 592 -1504 592
WIRE -1408 592 -1424 592
WIRE -1296 592 -1408 592
WIRE -1216 592 -1296 592
WIRE -1056 592 -1056 464
WIRE 704 592 704 560
WIRE 784 592 704 592
WIRE 1120 592 1120 560
WIRE 1216 592 1200 592
WIRE -1776 608 -1904 608
WIRE 1120 608 1120 592
WIRE 1120 608 992 608
WIRE -512 640 -528 640
WIRE -336 640 -448 640
WIRE 1120 640 1120 608
WIRE 784 656 704 656
WIRE 1072 656 784 656
WIRE -1504 688 -1504 592
WIRE -1488 688 -1504 688
WIRE -1136 688 -1136 592
WIRE -1120 688 -1136 688
WIRE -1408 704 -1408 592
WIRE -1408 704 -1424 704
WIRE -1040 704 -1056 704
WIRE -928 704 -1040 704
WIRE -640 704 -928 704
WIRE 704 704 704 656
WIRE 704 704 624 704
WIRE -1488 720 -1504 720
WIRE -1120 720 -1136 720
WIRE -528 720 -528 640
WIRE -528 720 -576 720
WIRE -512 720 -528 720
WIRE -432 720 -448 720
WIRE -640 736 -656 736
WIRE 544 736 544 704
WIRE -2048 752 -2144 752
WIRE 704 752 704 704
WIRE -2144 800 -2144 752
WIRE -2128 800 -2144 800
WIRE 96 800 96 400
WIRE 544 800 96 800
WIRE 640 800 544 800
WIRE -2048 816 -2048 752
WIRE -2048 816 -2064 816
WIRE -1904 816 -1904 688
WIRE -1904 816 -2048 816
WIRE -1584 816 -1904 816
WIRE -1504 816 -1504 720
WIRE -1136 816 -1136 720
WIRE -1120 816 -1136 816
WIRE -1040 816 -1040 704
WIRE -1040 816 -1056 816
WIRE -2128 832 -2192 832
WIRE 800 848 704 848
WIRE -656 896 -656 736
WIRE -432 896 -432 720
WIRE -432 896 -656 896
WIRE 96 928 96 880
WIRE 256 928 256 400
WIRE 256 928 96 928
WIRE 704 928 256 928
WIRE 944 928 704 928
WIRE 1120 928 1120 736
WIRE 1120 928 944 928
WIRE -656 992 -656 896
WIRE -64 992 -656 992
WIRE 16 1008 0 1008
WIRE 80 1008 16 1008
WIRE -832 1024 -944 1024
WIRE -64 1024 -80 1024
WIRE -1792 1088 -1888 1088
WIRE -80 1120 -80 1024
WIRE 16 1120 16 1008
WIRE 16 1120 -80 1120
WIRE -1888 1136 -1888 1088
WIRE -1872 1136 -1888 1136
WIRE -1792 1152 -1792 1088
WIRE -1792 1152 -1808 1152
WIRE -1584 1152 -1792 1152
WIRE -1488 1152 -1504 1152
WIRE -1408 1152 -1424 1152
WIRE -1264 1152 -1408 1152
WIRE -1200 1152 -1264 1152
WIRE -1104 1152 -1200 1152
WIRE -944 1152 -944 1024
WIRE -1936 1168 -1952 1168
WIRE -1872 1168 -1936 1168
WIRE -336 1216 -336 640
WIRE -336 1216 -448 1216
WIRE -1504 1248 -1504 1152
WIRE -1488 1248 -1504 1248
WIRE -1024 1248 -1024 1152
WIRE -1008 1248 -1024 1248
WIRE -1408 1264 -1408 1152
WIRE -1408 1264 -1424 1264
WIRE -928 1264 -944 1264
WIRE -816 1264 -928 1264
WIRE -640 1264 -816 1264
WIRE -1488 1280 -1504 1280
WIRE -1008 1280 -1024 1280
WIRE -512 1280 -512 1216
WIRE -512 1280 -576 1280
WIRE -496 1280 -512 1280
WIRE -432 1280 -432 896
WIRE -432 1280 -448 1280
WIRE -656 1296 -656 992
WIRE -640 1296 -656 1296
WIRE -432 1328 -432 1280
WIRE -1584 1376 -1632 1376
WIRE -1504 1376 -1504 1280
WIRE -1024 1376 -1024 1280
WIRE -1008 1376 -1024 1376
WIRE -928 1376 -928 1264
WIRE -928 1376 -944 1376
FLAG -160 -32 0
FLAG -336 -368 VCC2
FLAG -336 -192 VEE2
FLAG 944 928 VEE2
FLAG 368 -416 VEE2
FLAG 1024 -624 VCC2
FLAG 880 -416 VEE2
FLAG 1280 352 FCOM
FLAG 1440 -64 FCOM
FLAG -160 352 FCOM
FLAG -1744 560 FVCC
FLAG -1744 624 FVEE
FLAG -1456 672 FVCC
FLAG -1456 736 FVEE
FLAG -1632 1376 FCOM
FLAG -928 704 VERR
FLAG -944 544 FCOM
FLAG -2192 832 VSENSE
FLAG -1904 480 LO
FLAG -1088 736 FVCC
FLAG -1088 672 FVEE
FLAG -1216 816 FCOM
FLAG -2096 784 FVCC
FLAG -2096 848 FVEE
FLAG 1568 352 VSENSE
FLAG -256 -288 LO
FLAG -160 -64 LO
FLAG -544 208 ERR
FLAG 1344 -128 FVCC
FLAG 1248 16 FVCC
FLAG 1344 0 FVEE
FLAG 1216 592 FVEE
FLAG -16 464 LO
FLAG 1472 432 LO
FLAG 1216 -96 LO
FLAG -1840 1120 FVCC
FLAG -1840 1184 FVEE
FLAG -1456 1232 FVCC
FLAG -1456 1296 FVEE
FLAG -1424 1376 FCOM
FLAG -1936 1168 VSENSE
FLAG -1264 1152 IFB
FLAG -64 -80 FCOM
FLAG -1296 592 VFB
FLAG -1424 816 FCOM
FLAG -1200 1152 IFB
FLAG -816 1264 IERR
FLAG -832 1104 FCOM
FLAG -976 1296 FVCC
FLAG -976 1232 FVEE
FLAG -1104 1376 FCOM
FLAG -608 688 FVEE
FLAG -608 752 FVCC
FLAG -608 1312 FVCC
FLAG -608 1248 FVEE
FLAG -432 1408 FVEE
FLAG -336 560 FVCC
FLAG 80 1008 ERR
FLAG -32 1040 FVCC
FLAG -32 976 FVEE
SYMBOL voltage -336 -384 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 42 41 Left 2
SYMATTR Value 200
SYMATTR InstName V1
SYMBOL voltage -336 -288 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 0 36 39 Left 2
SYMATTR InstName V4
SYMATTR Value 200
SYMBOL npn 928 48 R0
SYMATTR InstName Q5
SYMATTR Value 2N3904
SYMBOL pnp 928 608 M180
SYMATTR InstName Q6
SYMATTR Value 2N3906
SYMBOL res 80 784 R0
SYMATTR InstName R9
SYMATTR Value 2k
SYMBOL res 688 832 R0
SYMATTR InstName R16
SYMATTR Value 10R
SYMBOL pnp 32 400 M180
SYMATTR InstName Q4
SYMBOL pnp 320 400 R180
SYMATTR InstName Q7
SYMBOL cap 768 96 R0
SYMATTR InstName C4
SYMATTR Value 1µ
SYMBOL zener 720 160 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D2
SYMATTR Value Z2V4
SYMBOL npn 640 752 R0
SYMATTR InstName Q1
SYMATTR Value 2N3904
SYMBOL pnp 256 -448 R180
SYMATTR InstName Q2
SYMATTR Value 2N3906
SYMBOL pnp 304 -496 M180
SYMATTR InstName Q3
SYMATTR Value 2N3906
SYMBOL res 176 -640 R0
SYMATTR InstName R3
SYMATTR Value 800R
SYMBOL res 352 -512 R0
SYMATTR InstName R4
SYMATTR Value 200k
SYMBOL pnp 768 -448 R180
SYMATTR InstName Q8
SYMATTR Value 2N3906
SYMBOL pnp 816 -496 M180
SYMATTR InstName Q9
SYMATTR Value 2N3906
SYMBOL res 688 -640 R0
SYMATTR InstName R5
SYMATTR Value 800R
SYMBOL res 864 -512 R0
SYMATTR InstName R6
SYMATTR Value 200k
SYMBOL res 640 688 R90
WINDOW 0 -35 61 VBottom 2
WINDOW 3 -34 51 VTop 2
SYMATTR InstName R7
SYMATTR Value 50R
SYMBOL cap 528 736 R0
WINDOW 0 -53 5 Left 2
WINDOW 3 -54 30 Left 2
SYMATTR InstName C1
SYMATTR Value 20p
SYMBOL res 1104 336 R0
SYMATTR InstName R8
SYMATTR Value 1R
SYMBOL res 1104 256 R0
SYMATTR InstName R10
SYMATTR Value 1R
SYMBOL zener 720 48 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMATTR Value Z16V
SYMBOL cap 768 -16 R0
SYMATTR InstName C3
SYMATTR Value 1µ
SYMBOL nmos 1072 -96 R0
SYMATTR InstName M1
SYMATTR Value IRFP240
SYMBOL pmos 1072 736 M180
SYMATTR InstName M2
SYMATTR Value IRFP9240
SYMBOL cap 768 592 R0
SYMATTR InstName C5
SYMATTR Value 1µ
SYMBOL cap 1328 -128 R0
SYMATTR InstName C6
SYMATTR Value 1µ
SYMBOL cap 1328 -64 R0
SYMATTR InstName C7
SYMATTR Value 1µ
SYMBOL zener 720 656 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D3
SYMATTR Value Z16V
SYMBOL res -320 192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 2k
SYMBOL cap 496 336 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C8
SYMATTR Value 100p
SYMBOL res -1888 704 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R2
SYMATTR Value 1k
SYMBOL res -1888 624 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R11
SYMATTR Value 19k
SYMBOL res -1488 576 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 25k
SYMBOL res -1408 576 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R13
SYMATTR Value 25k
SYMBOL res -1408 800 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R14
SYMATTR Value 25k
SYMBOL res -1488 800 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R15
SYMATTR Value 25k
SYMBOL voltage -944 448 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 -129 -58 Left 2
SYMATTR Value PULSE(-1 -2 0 100n 100n 0.2ms 0.4ms 7)
SYMATTR InstName VIN1
SYMBOL OpAmps\\LT1358 -1744 528 R0
SYMATTR InstName U1
SYMBOL OpAmps\\LT1358 -1456 640 R0
SYMATTR InstName U2
SYMBOL res -1120 832 M270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R17
SYMATTR Value 25k
SYMBOL res -1040 832 M270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R18
SYMATTR Value 25k
SYMBOL res -1040 608 M270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R19
SYMATTR Value 25k
SYMBOL res -1120 608 M270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R20
SYMATTR Value 25k
SYMBOL OpAmps\\LT1358 -1088 768 M180
SYMATTR InstName U3
SYMBOL OpAmps\\LT1358 -2096 752 R0
SYMATTR InstName U4
SYMBOL res -32 336 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R21
SYMATTR Value 2k
SYMBOL cap 0 464 R180
WINDOW 0 24 56 Left 2
WINDOW 3 24 8 Left 2
SYMATTR InstName C2
SYMATTR Value 100p
SYMBOL res 1456 336 R0
SYMATTR InstName R22
SYMATTR Value 100k
SYMBOL npn 1056 96 R0
SYMATTR InstName Q10
SYMATTR Value 2SC5200
SYMBOL pnp 1056 560 M180
WINDOW 3 85 0 Left 2
SYMATTR Value 2SA1943
SYMATTR InstName Q11
SYMBOL res 976 128 R0
SYMATTR InstName R23
SYMATTR Value 120R
SYMBOL res 976 416 R0
SYMATTR InstName R24
SYMATTR Value 120R
SYMBOL res 1424 336 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R25
SYMATTR Value 1k
SYMBOL npn 960 224 M0
SYMATTR InstName Q12
SYMATTR Value 2N3904
SYMBOL res 1056 256 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R26
SYMATTR Value 1k
SYMBOL diode 1184 -192 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D4
SYMBOL voltage 1216 -192 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 42 41 Left 2
SYMATTR Value 36
SYMATTR InstName V2
SYMBOL nmos 1072 -384 R0
SYMATTR InstName M3
SYMATTR Value IRFP240
SYMBOL diode 800 -288 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D5
SYMBOL diode 1072 -240 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D6
SYMBOL res 944 -320 R0
SYMATTR InstName R27
SYMATTR Value 20k
SYMBOL res -1488 1136 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R28
SYMATTR Value 25k
SYMBOL res -1408 1136 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R29
SYMATTR Value 25k
SYMBOL res -1408 1360 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R30
SYMATTR Value 25k
SYMBOL res -1488 1360 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R31
SYMATTR Value 25k
SYMBOL OpAmps\\LT1358 -1840 1088 R0
SYMATTR InstName U5
SYMBOL OpAmps\\LT1358 -1456 1200 R0
SYMATTR InstName U6
SYMBOL res 1216 0 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R32
SYMATTR Value 10R
SYMBOL res 1216 576 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R33
SYMATTR Value 10R
SYMBOL voltage -832 1008 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 -16 -29 Left 2
SYMATTR Value -0.3
SYMATTR InstName VIN2
SYMBOL res -1008 1392 M270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R34
SYMATTR Value 25k
SYMBOL res -928 1392 M270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R35
SYMATTR Value 25k
SYMBOL res -928 1168 M270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R36
SYMATTR Value 25k
SYMBOL res -1008 1168 M270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R37
SYMATTR Value 25k
SYMBOL OpAmps\\LT1358 -976 1328 M180
SYMATTR InstName U7
SYMBOL OpAmps\\LT1358 -608 784 M180
SYMATTR InstName U8
SYMBOL OpAmps\\LT1358 -608 1344 M180
SYMATTR InstName U9
SYMBOL diode -512 736 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D7
SYMBOL diode -512 1296 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D8
SYMBOL res -448 1312 R0
SYMATTR InstName R38
SYMATTR Value 100k
SYMBOL diode -448 624 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D9
SYMBOL diode -448 1200 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D10
SYMBOL res -352 544 R0
SYMATTR InstName R39
SYMATTR Value 100k
SYMBOL OpAmps\\LT1358 -32 1072 M180
SYMATTR InstName U10
TEXT -736 -424 Left 2 !.tran 3ms
TEXT 336 328 Left 2 ;minus
TEXT -16 328 Left 2 ;plus
TEXT -176 272 Left 2 ;Much faster. stable with 1k/100p.
TEXT 440 584 Left 2 ;compensaation
TEXT -728 -360 Left 2 !.ic V(FCOM)=0
TEXT -2224 824 Left 2 ;x20. works
TEXT 1392 528 Left 2 !.model Z16V ako:  BZX84C33VL bv=16\n.model Z2V4 ako:  BZX84C33VL bv=2.4
TEXT -1000 -128 Left 2 !.include standard.bjt
TEXT -1584 496 Left 2 ;reference to FCOM
TEXT -1200 440 Left 2 ;compare to VSET
TEXT -1584 1056 Left 2 ;pull out current. kelvin sensed.
TEXT 1944 -304 Left 2 ;Ok. it's regulating, current limited at the momnt.\nIt's hard to choose values that are good.\nset current at -0.3 and it current regulates around 30mA.\nset current at  1  and it voltage regulates +40V to +20V.
