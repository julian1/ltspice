Version 4
SHEET 1 2756 1912
WIRE 368 -624 192 -624
WIRE 704 -624 368 -624
WIRE 880 -624 704 -624
WIRE 1024 -624 880 -624
WIRE 1120 -624 1024 -624
WIRE 368 -592 368 -624
WIRE 880 -592 880 -624
WIRE 304 -544 192 -544
WIRE 816 -544 704 -544
WIRE 368 -496 256 -496
WIRE 880 -496 768 -496
WIRE 1120 -384 1120 -624
WIRE 704 -304 704 -448
WIRE 800 -304 704 -304
WIRE 960 -304 864 -304
WIRE 1056 -304 960 -304
WIRE 1072 -304 1056 -304
WIRE -256 -288 -336 -288
WIRE -336 -272 -336 -288
WIRE 1120 -240 1120 -288
WIRE 1120 -240 1056 -240
WIRE 1056 -224 1056 -240
WIRE 1056 -224 960 -224
WIRE 1120 -176 1120 -240
WIRE 1216 -176 1184 -176
WIRE 1120 -96 1120 -176
WIRE 1440 -64 1344 -64
WIRE -160 -32 -160 -80
WIRE 704 -16 704 -304
WIRE 784 -16 704 -16
WIRE 1072 -16 784 -16
WIRE 1120 16 1120 0
WIRE 1216 16 1120 16
WIRE 784 48 704 48
WIRE 1120 48 1120 16
WIRE 1120 48 992 48
WIRE 704 96 704 48
WIRE 784 96 704 96
WIRE 896 96 784 96
WIRE 928 96 896 96
WIRE 1120 96 1120 48
WIRE 1056 144 992 144
WIRE 784 160 704 160
WIRE -544 208 -624 208
WIRE -416 208 -544 208
WIRE 400 208 -336 208
WIRE 896 224 896 96
WIRE 1120 224 1120 192
WIRE 1120 224 992 224
WIRE 1120 272 1120 224
WIRE 1120 272 1040 272
WIRE 192 304 192 -448
WIRE 192 304 96 304
WIRE 256 304 192 304
WIRE -128 352 -160 352
WIRE -16 352 -48 352
WIRE 32 352 -16 352
WIRE 400 352 400 208
WIRE 400 352 320 352
WIRE 432 352 400 352
WIRE 896 352 896 320
WIRE 896 352 496 352
WIRE 1120 352 896 352
WIRE 1280 352 1120 352
WIRE 1328 352 1280 352
WIRE 1472 352 1408 352
WIRE 1568 352 1472 352
WIRE 1616 352 1568 352
WIRE -16 400 -16 352
WIRE 1120 432 992 432
WIRE 1120 464 1120 432
WIRE 1056 512 992 512
WIRE 704 560 704 160
WIRE 928 560 704 560
WIRE 704 592 704 560
WIRE 784 592 704 592
WIRE 1120 592 1120 560
WIRE 1216 592 1120 592
WIRE 1120 608 1120 592
WIRE 1120 608 992 608
WIRE 1120 640 1120 608
WIRE 784 656 704 656
WIRE 1072 656 784 656
WIRE 704 704 704 656
WIRE 704 704 624 704
WIRE 544 736 544 704
WIRE 704 752 704 704
WIRE -160 768 -272 768
WIRE 96 800 96 400
WIRE 544 800 96 800
WIRE 640 800 544 800
WIRE -1120 832 -1120 784
WIRE -912 832 -1008 832
WIRE 800 848 704 848
WIRE -1008 880 -1008 832
WIRE -992 880 -1008 880
WIRE -912 896 -912 832
WIRE -912 896 -928 896
WIRE -800 896 -912 896
WIRE -704 896 -720 896
WIRE -624 896 -640 896
WIRE -512 896 -624 896
WIRE -432 896 -512 896
WIRE -272 896 -272 768
WIRE -992 912 -1120 912
WIRE 96 928 96 880
WIRE 256 928 256 400
WIRE 256 928 96 928
WIRE 704 928 256 928
WIRE 944 928 704 928
WIRE 1120 928 1120 736
WIRE 1120 928 944 928
WIRE -720 992 -720 896
WIRE -704 992 -720 992
WIRE -352 992 -352 896
WIRE -336 992 -352 992
WIRE -624 1008 -624 896
WIRE -624 1008 -640 1008
WIRE -256 1008 -272 1008
WIRE -144 1008 -256 1008
WIRE -112 1008 -144 1008
WIRE -704 1024 -720 1024
WIRE -336 1024 -352 1024
WIRE -1264 1056 -1360 1056
WIRE -1360 1104 -1360 1056
WIRE -1344 1104 -1360 1104
WIRE -1264 1120 -1264 1056
WIRE -1264 1120 -1280 1120
WIRE -1120 1120 -1120 992
WIRE -1120 1120 -1264 1120
WIRE -800 1120 -1120 1120
WIRE -720 1120 -720 1024
WIRE -352 1120 -352 1024
WIRE -336 1120 -352 1120
WIRE -256 1120 -256 1008
WIRE -256 1120 -272 1120
WIRE -1344 1136 -1408 1136
WIRE -992 1392 -1088 1392
WIRE -1088 1440 -1088 1392
WIRE -1072 1440 -1088 1440
WIRE -992 1456 -992 1392
WIRE -992 1456 -1008 1456
WIRE -784 1456 -992 1456
WIRE -688 1456 -704 1456
WIRE -608 1456 -624 1456
WIRE -464 1456 -608 1456
WIRE -368 1456 -464 1456
WIRE -1136 1472 -1152 1472
WIRE -1072 1472 -1136 1472
WIRE -704 1552 -704 1456
WIRE -688 1552 -704 1552
WIRE -608 1568 -608 1456
WIRE -608 1568 -624 1568
WIRE -688 1584 -704 1584
WIRE -784 1680 -832 1680
WIRE -704 1680 -704 1584
FLAG -160 -32 0
FLAG -336 -368 VCC2
FLAG -336 -192 VEE2
FLAG 944 928 VEE2
FLAG 368 -416 VEE2
FLAG 1024 -624 VCC2
FLAG 880 -416 VEE2
FLAG 1280 352 FCOM
FLAG 1440 -64 FCOM
FLAG -160 352 FCOM
FLAG -960 864 FVCC
FLAG -960 928 FVEE
FLAG -672 976 FVCC
FLAG -672 1040 FVEE
FLAG -832 1680 FCOM
FLAG -144 1008 ERR
FLAG -160 848 FCOM
FLAG -1408 1136 VSENSE
FLAG -1120 784 LO
FLAG -304 1040 FVCC
FLAG -304 976 FVEE
FLAG -432 1120 FCOM
FLAG -1312 1088 FVCC
FLAG -1312 1152 FVEE
FLAG 1568 352 VSENSE
FLAG -256 -288 LO
FLAG -112 -192 LO
FLAG -544 208 ERR
FLAG 1344 -128 FVCC
FLAG 1216 16 FVCC
FLAG 1344 0 FVEE
FLAG 1216 592 FVEE
FLAG -16 464 LO
FLAG 1472 432 LO
FLAG 1216 -96 LO
FLAG -1040 1424 FVCC
FLAG -1040 1488 FVEE
FLAG -656 1536 FVCC
FLAG -656 1600 FVEE
FLAG -624 1680 FCOM
FLAG -1136 1472 VSENSE
FLAG -464 1456 IFB
FLAG -160 -80 FCOM
FLAG -512 896 VFB
FLAG -640 1120 FCOM
SYMBOL voltage -336 -384 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 42 41 Left 2
SYMATTR Value 200
SYMATTR InstName V1
SYMBOL voltage -336 -288 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 0 36 39 Left 2
SYMATTR InstName V4
SYMATTR Value 200
SYMBOL npn 928 48 R0
SYMATTR InstName Q5
SYMATTR Value 2N3904
SYMBOL pnp 928 608 M180
SYMATTR InstName Q6
SYMATTR Value 2N3906
SYMBOL res 80 784 R0
SYMATTR InstName R9
SYMATTR Value 2k
SYMBOL res 688 832 R0
SYMATTR InstName R16
SYMATTR Value 10R
SYMBOL pnp 32 400 M180
SYMATTR InstName Q4
SYMBOL pnp 320 400 R180
SYMATTR InstName Q7
SYMBOL cap 768 96 R0
SYMATTR InstName C4
SYMATTR Value 1µ
SYMBOL zener 720 160 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D2
SYMATTR Value Z2V4
SYMBOL npn 640 752 R0
SYMATTR InstName Q1
SYMATTR Value 2N3904
SYMBOL pnp 256 -448 R180
SYMATTR InstName Q2
SYMATTR Value 2N3906
SYMBOL pnp 304 -496 M180
SYMATTR InstName Q3
SYMATTR Value 2N3906
SYMBOL res 176 -640 R0
SYMATTR InstName R3
SYMATTR Value 800R
SYMBOL res 352 -512 R0
SYMATTR InstName R4
SYMATTR Value 200k
SYMBOL pnp 768 -448 R180
SYMATTR InstName Q8
SYMATTR Value 2N3906
SYMBOL pnp 816 -496 M180
SYMATTR InstName Q9
SYMATTR Value 2N3906
SYMBOL res 688 -640 R0
SYMATTR InstName R5
SYMATTR Value 800R
SYMBOL res 864 -512 R0
SYMATTR InstName R6
SYMATTR Value 200k
SYMBOL res 640 688 R90
WINDOW 0 -35 61 VBottom 2
WINDOW 3 -34 51 VTop 2
SYMATTR InstName R7
SYMATTR Value 50R
SYMBOL cap 528 736 R0
WINDOW 0 -53 5 Left 2
WINDOW 3 -54 30 Left 2
SYMATTR InstName C1
SYMATTR Value 20p
SYMBOL res 1104 336 R0
SYMATTR InstName R8
SYMATTR Value 1R
SYMBOL res 1104 256 R0
SYMATTR InstName R10
SYMATTR Value 1R
SYMBOL zener 720 48 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMATTR Value Z16V
SYMBOL cap 768 -16 R0
SYMATTR InstName C3
SYMATTR Value 1µ
SYMBOL nmos 1072 -96 R0
SYMATTR InstName M1
SYMATTR Value IRFP240
SYMBOL pmos 1072 736 M180
SYMATTR InstName M2
SYMATTR Value IRFP9240
SYMBOL cap 768 592 R0
SYMATTR InstName C5
SYMATTR Value 1µ
SYMBOL cap 1328 -128 R0
SYMATTR InstName C6
SYMATTR Value 1µ
SYMBOL cap 1328 -64 R0
SYMATTR InstName C7
SYMATTR Value 1µ
SYMBOL zener 720 656 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D3
SYMATTR Value Z16V
SYMBOL res -320 192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 2k
SYMBOL cap 496 336 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C8
SYMATTR Value 100p
SYMBOL res -1104 1008 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R2
SYMATTR Value 1k
SYMBOL res -1104 928 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R11
SYMATTR Value 19k
SYMBOL res -704 880 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 25k
SYMBOL res -624 880 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R13
SYMATTR Value 25k
SYMBOL res -624 1104 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R14
SYMATTR Value 25k
SYMBOL res -704 1104 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R15
SYMATTR Value 25k
SYMBOL voltage -160 752 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 -129 -58 Left 2
SYMATTR Value PULSE(2 -7 0 100n 100n 0.2ms 0.4ms 7)
SYMATTR InstName VIN1
SYMBOL OpAmps\\LT1358 -960 832 R0
SYMATTR InstName U1
SYMBOL OpAmps\\LT1358 -672 944 R0
SYMATTR InstName U2
SYMBOL res -336 1136 M270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R17
SYMATTR Value 25k
SYMBOL res -256 1136 M270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R18
SYMATTR Value 25k
SYMBOL res -256 912 M270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R19
SYMATTR Value 25k
SYMBOL res -336 912 M270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R20
SYMATTR Value 25k
SYMBOL OpAmps\\LT1358 -304 1072 M180
SYMATTR InstName U3
SYMBOL OpAmps\\LT1358 -1312 1056 R0
SYMATTR InstName U4
SYMBOL res -32 336 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R21
SYMATTR Value 2k
SYMBOL cap 0 464 R180
WINDOW 0 24 56 Left 2
WINDOW 3 24 8 Left 2
SYMATTR InstName C2
SYMATTR Value 100p
SYMBOL res 1456 336 R0
SYMATTR InstName R22
SYMATTR Value 1k
SYMBOL npn 1056 96 R0
SYMATTR InstName Q10
SYMATTR Value 2SC5200
SYMBOL pnp 1056 560 M180
WINDOW 3 85 0 Left 2
SYMATTR Value 2SA1943
SYMATTR InstName Q11
SYMBOL res 976 128 R0
SYMATTR InstName R23
SYMATTR Value 120R
SYMBOL res 976 416 R0
SYMATTR InstName R24
SYMATTR Value 120R
SYMBOL res 1424 336 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R25
SYMATTR Value 10R
SYMBOL npn 960 224 M0
SYMATTR InstName Q12
SYMATTR Value 2N3904
SYMBOL res 1056 256 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R26
SYMATTR Value 1k
SYMBOL diode 1184 -192 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D4
SYMBOL voltage 1216 -192 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 42 41 Left 2
SYMATTR Value 36
SYMATTR InstName V2
SYMBOL nmos 1072 -384 R0
SYMATTR InstName M3
SYMATTR Value IRFP240
SYMBOL diode 800 -288 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D5
SYMBOL diode 1072 -240 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D6
SYMBOL res 944 -320 R0
SYMATTR InstName R27
SYMATTR Value 20k
SYMBOL res -688 1440 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R28
SYMATTR Value 25k
SYMBOL res -608 1440 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R29
SYMATTR Value 25k
SYMBOL res -608 1664 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R30
SYMATTR Value 25k
SYMBOL res -688 1664 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R31
SYMATTR Value 25k
SYMBOL OpAmps\\LT1358 -1040 1392 R0
SYMATTR InstName U5
SYMBOL OpAmps\\LT1358 -656 1504 R0
SYMATTR InstName U6
TEXT -736 -424 Left 2 !.tran 3ms
TEXT 336 328 Left 2 ;minus
TEXT -16 328 Left 2 ;plus
TEXT -176 272 Left 2 ;Much faster. stable with 1k/100p.
TEXT 440 584 Left 2 ;compensaation
TEXT -728 -360 Left 2 !.ic V(FCOM)=0
TEXT -1440 1128 Left 2 ;x20. works
TEXT 1392 528 Left 2 !.model Z16V ako:  BZX84C33VL bv=16\n.model Z2V4 ako:  BZX84C33VL bv=2.4
TEXT -1000 -128 Left 2 !.include standard.bjt
TEXT 1648 -16 Left 2 ;With Darlington. nice. works.
TEXT 1624 -72 Left 2 ;This is stable with load 100R/0.7A to 1G.
TEXT 1616 -272 Left 2 ;advantage  - class AB, rather than class B.\ndisadvantage - needs two current sources\n-\ndifferential integrator. clear compensation.\nfast.\nintegrated bootstrap supply
TEXT -800 800 Left 2 ;reference to FCOM
TEXT -416 744 Left 2 ;compare to VSET
TEXT -1240 648 Left 2 ;upside down, float referenced divider
TEXT 1608 72 Left 2 ;current limit. \n10R and 64mA == V=IR. 0.064 * 10 = 0.64V is limit\n1R, limit is 0.64A. or a bit less.\n \ndo a step model, for loads.
TEXT 1504 -392 Left 2 ;Ok. 10k. and the simulation doesn't complete. 20k and it's good.
TEXT -784 1360 Left 2 ;pull out current. kelvin sensed.
