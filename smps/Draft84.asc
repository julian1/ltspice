Version 4
SHEET 1 4244 1268
WIRE 2064 -640 1936 -640
WIRE 2176 -624 2112 -624
WIRE 2288 -624 2176 -624
WIRE 2384 -624 2288 -624
WIRE 2512 -624 2464 -624
WIRE 2592 -624 2512 -624
WIRE 2848 -624 2592 -624
WIRE 2016 -560 1936 -560
WIRE 2064 -560 2064 -640
WIRE 2112 -560 2064 -560
WIRE 2208 -560 2176 -560
WIRE 2512 -544 2512 -560
WIRE 2592 -544 2512 -544
WIRE 2736 -544 2592 -544
WIRE 2848 -544 2736 -544
WIRE 2912 -544 2848 -544
WIRE 2176 -496 2112 -496
WIRE 2208 -480 2208 -560
WIRE 2208 -480 1936 -480
WIRE 2736 -480 2736 -544
WIRE 1152 -448 1152 -512
WIRE 1728 -448 1728 -512
WIRE 2592 -416 2592 -544
WIRE 2784 -416 2736 -416
WIRE 2512 -400 2512 -544
WIRE 1248 -368 1152 -368
WIRE 1584 -368 1568 -368
WIRE 2512 -352 2512 -368
WIRE 2176 -336 2176 -496
WIRE 2288 -336 2288 -480
WIRE 2288 -336 2176 -336
WIRE 2384 -336 2288 -336
WIRE 2512 -336 2464 -336
WIRE 2592 -336 2512 -336
WIRE 2736 -336 2592 -336
WIRE 2848 -336 2848 -368
WIRE 2848 -336 2736 -336
WIRE 1088 -320 1072 -320
WIRE 1664 -320 1648 -320
WIRE 1152 -240 1152 -272
WIRE 1152 -240 1072 -240
WIRE 1296 -240 1152 -240
WIRE 1648 -240 1296 -240
WIRE 1728 -240 1728 -272
WIRE 1728 -240 1648 -240
WIRE 816 -48 736 -48
WIRE 736 -32 736 -48
WIRE 816 -32 816 -48
WIRE 1120 176 1024 176
WIRE 1216 176 1120 176
WIRE 1120 304 1120 176
WIRE 1152 304 1120 304
WIRE 1328 304 1216 304
FLAG 816 -32 0
FLAG 736 -128 VCC
FLAG 736 48 VEE
FLAG 560 -32 0
FLAG 560 -112 P15V
FLAG 2912 -544 0
FLAG 2016 -560 0
FLAG 1024 256 0
FLAG 1152 -160 0
FLAG 1152 -592 P15V
FLAG 1296 -240 IRAMP
FLAG 1728 -592 P15V
FLAG 928 -368 SW1
FLAG 1488 -368 SW2
FLAG 1072 -416 P15V
FLAG 1648 -416 P15V
FLAG 1216 176 SW1
FLAG 1328 304 SW2
SYMBOL voltage 736 -144 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 48 40 Left 2
SYMATTR Value 5
SYMATTR InstName V2
SYMBOL voltage 736 -48 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 0 36 39 Left 2
SYMATTR InstName V3
SYMATTR Value 0
SYMBOL voltage 560 -128 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 48 40 Left 2
SYMATTR Value 15
SYMATTR InstName V4
SYMBOL ind2 1920 -464 M180
WINDOW 0 36 80 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName L2
SYMATTR Value 2001µ
SYMATTR Type ind
SYMBOL diode 2128 -560 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMBOL diode 2192 -560 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D2
SYMBOL diode 2128 -496 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D3
SYMBOL diode 2192 -496 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D4
SYMBOL cap 2496 -624 R0
SYMATTR InstName C1
SYMATTR Value 0.5µ
SYMBOL res 2576 -640 R0
SYMATTR InstName R7
SYMATTR Value 1k
SYMBOL ind2 2368 -608 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 4 56 VBottom 2
SYMATTR InstName L4
SYMATTR Value 47µ
SYMATTR Type ind
SYMBOL ind2 1920 -544 M180
WINDOW 0 36 80 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName L5
SYMATTR Value 2001µ
SYMATTR Type ind
SYMBOL ind2 2368 -320 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 4 56 VBottom 2
SYMATTR InstName L6
SYMATTR Value 47µ
SYMATTR Type ind
SYMBOL cap 2496 -400 R0
SYMATTR InstName C2
SYMATTR Value 0.5µ
SYMBOL res 2576 -432 R0
SYMATTR InstName R3
SYMATTR Value 10k
SYMBOL npn 2784 -464 R0
SYMATTR InstName Q3
SYMBOL res 2720 -432 R0
SYMATTR InstName R5
SYMATTR Value 1k
SYMBOL zener 2752 -416 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D5
SYMATTR Value MYD
SYMBOL res 2832 -560 R0
SYMATTR InstName R14
SYMATTR Value 0.01R
SYMBOL voltage 1024 160 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 -294 -29 Left 2
SYMATTR Value PULSE(0 5 1us 10ns 10ns 25us 50us 20)
SYMATTR InstName V1
SYMBOL Digital\\inv 1152 240 R0
WINDOW 3 8 60 Left 2
SYMATTR Value Vhigh=5
SYMATTR InstName A1
SYMBOL cap 2272 -624 R0
SYMATTR InstName C3
SYMATTR Value 1n
SYMBOL res 2272 -576 R0
SYMATTR InstName R10
SYMATTR Value 270R
SYMBOL ind2 1136 -464 R0
SYMATTR InstName L7
SYMATTR Value 50µ
SYMATTR Type ind
SYMBOL npn 1088 -368 R0
SYMATTR InstName Q4
SYMATTR Value FJL4315
SYMBOL res 1136 -256 R0
SYMATTR InstName R13
SYMATTR Value 0.1R
SYMBOL res 1168 -496 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R16
SYMATTR Value 0.01R
SYMBOL ind2 1744 -352 R180
WINDOW 0 36 80 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName L8
SYMATTR Value 50µ
SYMATTR Type ind
SYMBOL npn 1664 -368 R0
SYMATTR InstName Q5
SYMATTR Value FJL4315
SYMBOL res 1744 -496 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R17
SYMATTR Value 0.01R
SYMBOL res 1024 -384 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R18
SYMATTR Value 1k
SYMBOL res 1584 -384 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R19
SYMATTR Value 1k
SYMBOL npn 1008 -416 R0
SYMATTR InstName Q6
SYMATTR Value 2N3904
SYMBOL res 1088 -224 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R20
SYMATTR Value 120R
SYMBOL npn 1584 -416 R0
SYMATTR InstName Q7
SYMATTR Value 2N3904
SYMBOL res 1664 -224 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R21
SYMATTR Value 120R
TEXT 392 -288 Left 2 !.tran 1.2ms
TEXT 352 -376 Left 2 !.include 74hc.lib
TEXT -328 352 Left 2 ;Having RC charged by VCC. guarantees a cold-start pulse.\n- we get clearly defined phases\n- start pulse.\n- finish of current ramp .\n- finish cycle. fixed timing.
TEXT 2280 168 Left 2 ;Use 10k and gate capacitance, to slow the reset timing.\n \n74hc74 pinout appears the same as 74hc74d.\n \ninputs are considered active lo.\nCLR/ RD (pin 1) hi, turns Q hi. CLR dominates.  (reset as active low)\nPRE / SD  (pin 4 ) hi, turns Q lo. ~Q high.
TEXT 1904 -872 Left 2 !K L7 L8 L5 L2 0.99
TEXT 3352 -608 Left 2 ;OKK. strange we got rid of the output inductor. and current still ramps nicely.\nAlso no inductive spike on the collectors with real BJT.\n \n100kHz\n \n50V/50mA.  1k.  15V * Math.sqrt( 1000) / Math.sqrt(100) = 47\n \n100V/50mA 1k load. 15 * Math.sqrt( 1000) / Math.sqrt(22) = 101\n \n100V/100mA.  with 100R bjt drive.
TEXT 352 -440 Left 2 !.include standard.bjt
TEXT 2752 -144 Left 2 !.model MYD D(Bv=120 type=zener)
TEXT 384 -496 Left 2 !.include my.lib
TEXT 2200 -712 Left 2 ;Math.sqrt(2000) / Math.sqrt(50) * 15 = 94
TEXT 1824 -832 Left 2 ;Runs ok, on second attempt. push-pull with discrete cmos driver.
